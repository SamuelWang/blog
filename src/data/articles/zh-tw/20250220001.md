---
title: "在 Hyper-V 上安裝 Ubuntu Server"
slug: "installing-ubuntu-server-on-hyper-v"
author: "Samuel Wang"
description: "逐步說明如何在 Microsoft Hyper-V 上安裝 Ubuntu Server，包含設定與最佳化。"
tags: ["Ubuntu", "Hyper-V", "Infrastructure"]
releaseDate: "2025-02-20"
updateDate: "2025-02-20"
---

## 安裝 Ubuntu

從 Ubuntu 官方網站下載 ISO 映像檔：  
[https://ubuntu.com/download/server](https://ubuntu.com/download/server)

建立新的虛擬機器（VM），步驟參考：  
[https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/create-virtual-machine](https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/create-virtual-machine)

選擇剛下載的 ISO 作為開機映像，啟動 VM 並依照安裝指示進行。

如果遇到以下錯誤，可以嘗試停用 Secure Boot 或改用 Generation 1。

![Secure Boot Error](/images/articles/20250220001/secure-boot-error.png)

設定 VM 的靜態 IP

通常我們會先以動態 IP 存取 VM，但動態 IP 可能會變動，之後就需要用新的 IP 才能連線。

為了方便，我們可以為 VM 設定並使用靜態 IP。

首先建立一個 NAT 網路：  
[https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/setup-nat-network](https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/setup-nat-network)

> 注意網路段（network segment）不可與目前的網段相同。例如我的 WiFi IP 為 192.16.0.17，閘道為 192.168.0.1，因此我使用 192.168.56.1 作為 VM 交換器的 IP。

接著登入 VM，執行 `ip link` 以確認乙太網路介面，範例如下圖預設介面為 “eth0”：

![ip link](/images/articles/20250220001/ip-link.png)

執行 `cd /etc/netplan` 切換到 netplan 資料夾，然後用 `ls -al .` 列出設定檔。常見檔名為 `01-netcfg.yaml` 或 `50-cloud-init.yaml`，用編輯器（例如 vim）打開該檔案。

編輯內容為：

![netplan config](/images/articles/20250220001/netplan-config.png)

儲存檔案後，執行 `sudo chmod 600 /etc/netplan/50-cloud-init.yaml` 以設定檔案權限，然後執行 `sudo netplan apply` 套用變更。

接著嘗試 `ping google.com`，應該可以通。 

## （選用）安裝 zsh 及相關外掛

安裝 zsh：  
`sudo apt install zsh`

將 zsh 設為預設 shell：  
`chsh -s $(which zsh)`

安裝 oh-my-zsh：  
[https://ohmyz.sh/#install](https://ohmyz.sh/#install)

安裝 powerlevel10k：  
[https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#oh-my-zsh](https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#oh-my-zsh)

安裝 zsh-completions：  
[https://github.com/zsh-users/zsh-completions](https://github.com/zsh-users/zsh-completions)

安裝 zsh-autosuggestions：  
[https://github.com/zsh-users/zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions)

安裝 zsh-syntax-highlighting：  
[https://github.com/zsh-users/zsh-syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting)
